from django.shortcuts import render,redirect,get_object_or_404
from django.http.response import HttpResponseRedirect,HttpResponse
from django.contrib.auth import get_user_model, authenticate
from django.contrib.auth import authenticate, login, logout
from django.contrib import messages
from .models import DataFileUpload
def base(request):
    return render(request,'homeApp/landing_page.html')

def upload_credit_data(request):
    return render(request,'homeApp/upload_credit_data.html')
def prediction_button(request):
    return render(request,'homeApp/fraud_detection.html')

def reports(request):
    all_data_files_objs=DataFileUpload.objects.all()
    return render(request,'homeApp/reports.html',{'all_files':all_data_files_objs})

def enter_form_data_manually(request):
    return render(request,'homeApp/enter_form_data_manually.html')
def predict_data_manually(request):
    return render(request,'homeApp/predict_data_manually.html')

def add_files_single(request):
    return render(request,'homeApp/add_files_single.html')
def predict_csv_single(request):
    return render(request,'homeApp/predict_csv_single.html')

def add_files_multi(request):
    return render(request,'homeApp/add_files_multi.html')

def predict_csv_multi(request):
    fraudlist={'bb1': [8408, -1.81328048476897, 4.91785071056565, -5.92612969400656, 5.70150043141163, 1.20439257214362, -3.03513754815611, -1.71340206347108, 0.561257390902032, -3.79635425171163, -7.45484065078351, 7.38805512292025, -10.4752286504099, -0.379314526756117, -11.7367291212569, -2.08698895215593, -2.44235398293755, -3.53552351168246, 0.130360306640887, -2.07145048844325, 0.576656033332069, 0.615641835107552, -0.4064272753179, -0.73701807643754, -0.279641772215917, 1.1067663744335, 0.323885477719453, 0.894766671515833, 0.569518600269514, 1, 1], 'bb2': [406, -2.3122265423263, 1.95199201064158, -1.60985073229769, 3.9979055875468, -0.522187864667764, -1.42654531920595, -2.53738730624579, 1.39165724829804, -2.77008927719433, -2.77227214465915, 3.20203320709635, -2.89990738849473, -0.595221881324605, -4.28925378244217, 0.389724120274487, -1.14074717980657, -2.83005567450437, -0.0168224681808257, 0.416955705037907, 0.126910559061474, 0.517232370861764, -0.0350493686052974, -0.465211076182388, 0.320198198514526, 0.0445191674731724, 0.177839798284401, 0.261145002567677, -0.143275874698919, 0, 1],'bb3': [472, -3.0435406239976, -3.15730712090228, 1.08846277997285, 2.2886436183814, 1.35980512966107, -1.06482252298131, 0.325574266158614, -0.0677936531906277, -0.270952836226548, -0.838586564582682, -0.414575448285725, -0.503140859566824, 0.676501544635863, -1.69202893305906, 2.00063483909015, 0.666779695901966, 0.599717413841732, 1.72532100745514, 0.283344830149495, 2.10233879259444, 0.661695924845707, 0.435477208966341, 1.37596574254306, -0.293803152734021, 0.279798031841214, -0.145361714815161, -0.252773122530705, 0.0357642251788156, 529, 1],'bb4': [4462, -2.30334956758553, 1.759247460267, -0.359744743330052, 2.33024305053917, -0.821628328375422, -0.0757875706194599, 0.562319782266954, -0.399146578487216, -0.238253367661746, -1.52541162656194, 2.03291215755072, -6.56012429505962, 0.0229373234890961, -1.47010153611197, -0.698826068579047, -2.28219382856251, -4.78183085597533, -2.61566494476124, -1.33444106667307, -0.430021867171611, -0.294166317554753, -0.932391057274991, 0.172726295799422, -0.0873295379700724, -0.156114264651172, -0.542627889040196, 0.0395659889264757, -0.153028796529788, 239.93, 1],'bb5': [6986, -4.39797444171999, 1.35836702839758, -2.5928442182573, 2.67978696694832, -1.12813094208956, -1.70653638774951, -3.49619729302467, -0.248777743025673, -0.24776789948008, -4.80163740602813, 4.89584422347523, -10.9128193194019, 0.184371685834387, -6.77109672468083, -0.00732618257771211, -7.35808322132346, -12.5984185405511, -5.13154862842983, 0.308333945758691, -0.17160787864796, 0.573574068424352, 0.176967718048195, -0.436206883597401, -0.0535018648884285, 0.252405261951833, -0.657487754764504, -0.827135714578603, 0.849573379985768, 59, 1],'bb6': [7519, 1.23423504613468, 3.0197404207034, -4.30459688479665, 4.73279513041887, 3.62420083055386, -1.35774566315358, 1.71344498787235, -0.496358487073991, -1.28285782036322, -2.44746925511151, 2.10134386504854, -4.6096283906446, 1.46437762476188, -6.07933719308005, -0.339237372732577, 2.58185095378146, 6.73938438478335, 3.04249317830411, -2.72185312222835, 0.00906083639534526, -0.37906830709218, -0.704181032215427, -0.656804756348389, -1.63265295692929, 1.48890144838237, 0.566797273468934, -0.0100162234965625, 0.146792734916988, 1, 1],'bb7': [7526, 0.00843036489558254, 4.13783683497998, -6.24069657194744, 6.6757321631344, 0.768307024571449, -3.35305954788994, -1.63173467271809, 0.15461244822474, -2.79589246446281, -6.18789062970647, 5.66439470857116, -9.85448482287037, -0.306166658250084, -10.6911962118171, -0.638498192673322, -2.04197379107768, -1.12905587703585, 0.116452521226364, -1.93466573889727, 0.488378221134715, 0.36451420978479, -0.608057133838703, -0.539527941820093, 0.128939982991813, 1.48848121006868, 0.50796267782385, 0.735821636119662, 0.513573740679437, 1, 1],'bb8': [7610, 0.725645739819857, 2.30089443776603, -5.32997618300917, 4.007682804682, -1.73041059025206, -1.73219256822244, -3.96859261813707, 1.06372815344105, -0.486096552344833, -4.62498495406596, 5.5887239146762, -7.14824263637845, 1.68045074096412, -6.21025774661028, 0.495282117814298, -3.5995402092184, -4.83032424210571, -0.649090120211694, 2.2501232487881, 0.504646226103286, 0.589669127323198, 0.109541319229913, 0.601045276521079, -0.364700278220039, -1.84307769215194, 0.351909298434892, 0.594549978086464, 0.0993722360416487, 1, 1],'bb9': [7740, 1.02387386852139, 2.00148526626613, -4.76975183220974, 3.81919458538265, -1.2717542273697, -1.7346624268403, -3.05924503160896, 0.889804791975203, 0.415382113237262, -3.95581234352737, 3.57205481558784, -7.18645159050588, 0.147242340802109, -5.24930454889762, 1.67833367358535, -2.64147310915178, -1.31205856007348, -0.391716050952505, 1.11826355175812, 0.204137684042271, 0.343282648722251, -0.0541956644068491, 0.709653952497143, -0.372215866946976, -2.03206836614816, 0.366777602071192, 0.395170669257609, 0.0202055389458413, 1, 1],'bb10': [8090, -1.78322883722709, 3.40279371307631, -3.82274226552205, 2.62536815276644, -1.97641541136284, -2.73168901231308, -3.43055914949085, 1.41320351399318, -0.776941494554916, -6.19988176274188, 4.36671348631445, -8.24326243368313, 0.345761165232579, -6.59055029705192, 0.265576095932165, -3.02845238846152, -4.21448627485607, -1.21360784773725, -0.265421595374812, 0.364089115014408, 0.454031931736316, -0.577525824201459, 0.0459665375362652, 0.461700017592254, 0.044146161217817, 0.305704433918549, 0.530980986346765, 0.243745598122111, 1, 1]}
    return render(request,'homeApp/predict_csv_multi.html', fraudlist)

def account_details(request):
    return render(request,'homeApp/account_details.html')
def change_password(request):
    return render(request,'homeApp/change_password.html')
def analysis(request):
    return render(request,'homeApp/analysis.html')
def view_data(request):
    transactions_list={'aa1': [-1.3598071336738,-0.0727811733098497,2.53634673796914,1.37815522427443,-0.338320769942518,0.462387777762292,0.239598554061257,0.0986979012610507,0.363786969611213,0.0907941719789316,-0.551599533260813,-0.617800855762348,-0.991389847235408,-0.311169353699879,1.46817697209427,-0.470400525259478,0.207971241929242,0.0257905801985591,0.403992960255733,0.251412098239705,-0.018306777944153,0.277837575558899,-0.110473910188767,0.0669280749146731,0.128539358273528,-0.189114843888824,0.133558376740387,-0.0210530534538215,149.62,0], 'aa2': [1.19185711131486,0.26615071205963,0.16648011335321,0.448154078460911,0.0600176492822243,-0.0823608088155687,-0.0788029833323113,0.0851016549148104,-0.255425128109186,-0.166974414004614,1.61272666105479,1.06523531137287,0.48909501589608,-0.143772296441519,0.635558093258208,0.463917041022171,-0.114804663102346,-0.183361270123994,-0.145783041325259,-0.0690831352230203,-0.225775248033138,-0.638671952771851,0.101288021253234,-0.339846475529127,0.167170404418143,0.125894532368176,-0.00898309914322813,0.0147241691924927,2.69,0], 'aa3': [-1.35835406159823,-1.34016307473609,1.77320934263119,0.379779593034328,-0.503198133318193,1.80049938079263,0.791460956450422,0.247675786588991,-1.51465432260583,0.207642865216696,0.624501459424895,0.066083685268831,0.717292731410831,-0.165945922763554,2.34586494901581,-2.89008319444231,1.10996937869599,-0.121359313195888,-2.26185709530414,0.524979725224404,0.247998153469754,0.771679401917229,0.909412262347719,-0.689280956490685,-0.327641833735251,-0.139096571514147,-0.0553527940384261,-0.0597518405929204,378.66,0], 'aa4': [-0.966271711572087,-0.185226008082898,1.79299333957872,-0.863291275036453,-0.0103088796030823,1.24720316752486,0.23760893977178,0.377435874652262,-1.38702406270197,-0.0549519224713749,-0.226487263835401,0.178228225877303,0.507756869957169,-0.28792374549456,-0.631418117709045,-1.0596472454325,-0.684092786345479,1.96577500349538,-1.2326219700892,-0.208037781160366,-0.108300452035545,0.00527359678253453,-0.190320518742841,-1.17557533186321,0.647376034602038,-0.221928844458407,0.0627228487293033,0.0614576285006353,123.5,0], 'aa5': [-1.15823309349523,0.877736754848451,1.548717846511,0.403033933955121,-0.407193377311653,0.0959214624684256,0.592940745385545,-0.270532677192282,0.817739308235294,0.753074431976354,-0.822842877946363,0.53819555014995,1.3458515932154,-1.11966983471731,0.175121130008994,-0.451449182813529,-0.237033239362776,-0.0381947870352842,0.803486924960175,0.408542360392758,-0.00943069713232919,0.79827849458971,-0.137458079619063,0.141266983824769,-0.206009587619756,0.502292224181569,0.219422229513348,0.215153147499206,69.99,0], 'aa6': [-0.425965884412454,0.960523044882985,1.14110934232219,-0.168252079760302,0.42098688077219,-0.0297275516639742,0.476200948720027,0.260314333074874,-0.56867137571251,-0.371407196834471,1.34126198001957,0.359893837038039,-0.358090652573631,-0.137133700217612,0.517616806555742,0.401725895589603,-0.0581328233640131,0.0686531494425432,-0.0331937877876282,0.0849676720682049,-0.208253514656728,-0.559824796253248,-0.0263976679795373,-0.371426583174346,-0.232793816737034,0.105914779097957,0.253844224739337,0.0810802569229443,3.67,0], 'aa7': [1.22965763450793,0.141003507049326,0.0453707735899449,1.20261273673594,0.191880988597645,0.272708122899098,-0.00515900288250983,0.0812129398830894,0.464959994783886,-0.0992543211289237,-1.41690724314928,-0.153825826253651,-0.75106271556262,0.16737196252175,0.0501435942254188,-0.443586797916727,0.00282051247234708,-0.61198733994012,-0.0455750446637976,-0.21963255278686,-0.167716265815783,-0.270709726172363,-0.154103786809305,-0.780055415004671,0.75013693580659,-0.257236845917139,0.0345074297438413,0.00516776890624916,4.99,0], 'aa8': [-0.644269442348146,1.41796354547385,1.0743803763556,-0.492199018495015,0.948934094764157,0.428118462833089,1.12063135838353,-3.80786423873589,0.615374730667027,1.24937617815176,-0.619467796121913,0.291474353088705,1.75796421396042,-1.32386521970526,0.686132504394383,-0.0761269994382006,-1.2221273453247,-0.358221569869078,0.324504731321494,-0.156741852488285,1.94346533978412,-1.01545470979971,0.057503529867291,-0.649709005559993,-0.415266566234811,-0.0516342969262494,-1.20692108094258,-1.08533918832377,40.8,0], 'aa9': [-0.89428608220282,0.286157196276544,-0.113192212729871,-0.271526130088604,2.6695986595986,3.72181806112751,0.370145127676916,0.851084443200905,-0.392047586798604,-0.410430432848439,-0.705116586646536,-0.110452261733098,-0.286253632470583,0.0743553603016731,-0.328783050303565,-0.210077268148783,-0.499767968800267,0.118764861004217,0.57032816746536,0.0527356691149697,-0.0734251001059225,-0.268091632235551,-0.204232669947878,1.0115918018785,0.373204680146282,-0.384157307702294,0.0117473564581996,0.14240432992147,93.2,0], 'aa10': [-0.33826175242575,1.11959337641566,1.04436655157316,-0.222187276738296,0.49936080649727,-0.24676110061991,0.651583206489972,0.0695385865186387,-0.736727316364109,-0.366845639206541,1.01761446783262,0.836389570307029,1.00684351373408,-0.443522816876142,0.150219101422635,0.739452777052119,-0.540979921943059,0.47667726004282,0.451772964394125,0.203711454727929,-0.246913936910008,-0.633752642406113,-0.12079408408185,-0.385049925313426,-0.0697330460416923,0.0941988339514961,0.246219304619926,0.0830756493473326,3.68,0]}
    return render(request, 'homeApp/view_data.html',transactions_list)
def delete_data(request,id):
    obj=DataFileUpload.objects.get(id=id)
    obj.delete()
    messages.success(request, "File Deleted succesfully",extra_tags = 'alert alert-success alert-dismissible show')
    return HttpResponseRedirect('/reports')
def upload_data(request):
    if request.method == 'POST':
            data_file_name  = request.POST.get('data_file_name')
            try:
                actual_file = request.FILES['actual_file_name']

            except:
                messages.warning(request, "Invalid/wrong format. Please upload File.")
                return redirect('/upload_credit_data')
            description  = request.POST.get('description')

            DataFileUpload.objects.create(
                        file_name=data_file_name,
                        actual_file=actual_file,
                        description=description,

                    )
            messages.success(request, "File Uploaded succesfully",extra_tags = 'alert alert-success alert-dismissible show')
            return HttpResponseRedirect('/reports')
    # return HttpResponseRedirect('reports')


def userLogout(request):
    try:
      del request.session['username']
    except:
      pass
    logout(request)
    return HttpResponseRedirect('/')


def login2(request):
    data = {}
    if request.method == "POST":
        username = request.POST['username']
        password = request.POST['password']
        user = authenticate(request, username=username, password=password)
        print(user)
        if user:
            login(request, user)
            return HttpResponseRedirect('/')

        else:
            data['error'] = "Username or Password is incorrect"
            res = render(request, 'homeApp/login.html', data)
            return res
    else:
        return render(request, 'homeApp/login.html', data)


def about(request):
    return render(request,'homeApp/about.html')

def dashboard(request):
    return render(request,'homeApp/dashboard.html')
